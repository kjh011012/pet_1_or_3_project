<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ì¹´ì˜¤í†¡ ìŠ¤íƒ€ì¼ ì±—ë´‡</title>
    <!-- External CSS ì¶”ê°€ -->
    <link rel="stylesheet" href="../static/css/chatstyle.css">
</head>
<body>

<div class="chat-container">
    <div class="chat-header">í–‰ë³µë‚˜ì¹¨ë°˜ AI ì±„íŒ…ë´‡</div>

    <div class="chat-body" id="chat-body">
        <!-- ì±„íŒ… ë©”ì‹œì§€ê°€ ì´ê³³ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>

    <div class="chat-footer">
        <input type="text" id="user-input" class="input-box" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeydown="checkSend(event)">
        <button class="send-button" onclick="sendMessage()">ì „ì†¡</button>
    </div>
</div>

<script>
    // íƒ€ì´í•‘ íš¨ê³¼ë¥¼ êµ¬í˜„í•˜ëŠ” í•¨ìˆ˜ (ì†Œê°œ ë©”ì‹œì§€ì—ë§Œ ì ìš©)
    function typeText(element, text, interval, callback) {
        let index = 0;
        function type() {
            if (index < text.length) {
                element.innerHTML += text.charAt(index);
                index++;
                setTimeout(type, interval); // ì¼ì • ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ê¸€ìë¥¼ ì¶œë ¥
            } else if (callback) {
                callback(); // ê¸€ìê°€ ëª¨ë‘ ì¶œë ¥ëœ í›„ ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ
            }
        }
        type();
    }

    // ë©”ì‹œì§€ë¥¼ ì±„íŒ…ì°½ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ (ì†Œê°œ ë©”ì‹œì§€ ì œì™¸ íƒ€ì´í•‘ íš¨ê³¼ ì—†ìŒ)
    function appendMessage(message, sender, typingEffect = false, callback) {
        const chatBody = document.getElementById('chat-body');
        const messageContainer = document.createElement('div');
        messageContainer.classList.add('chat-message', sender === 'user' ? 'message-user' : 'message-bot');

        // ë´‡ì¸ ê²½ìš° ì´ë¦„ ì¶”ê°€
        if (sender === 'bot') {
            const botName = document.createElement('div');
            botName.classList.add('bot-name');
            botName.textContent = 'í–‰ë³µ AI'; // ë´‡ ì´ë¦„ì„ í‘œì‹œ
            messageContainer.appendChild(botName);
        }

        const messageBubble = document.createElement('div');
        messageBubble.classList.add('message-bubble', sender === 'user' ? 'user-bubble' : 'bot-bubble');
        
        // íƒ€ì´í•‘ íš¨ê³¼ê°€ í•„ìš”í•œ ê²½ìš°
        if (typingEffect) {
            messageContainer.appendChild(messageBubble);
            chatBody.appendChild(messageContainer);
            chatBody.scrollTop = chatBody.scrollHeight; // ìë™ ìŠ¤í¬ë¡¤
            typeText(messageBubble, message, 30, callback); // íƒ€ì´í•‘ íš¨ê³¼
        } else {
            // íƒ€ì´í•‘ íš¨ê³¼ê°€ í•„ìš” ì—†ëŠ” ê²½ìš°
            messageBubble.innerHTML = message;
            messageContainer.appendChild(messageBubble);
            chatBody.appendChild(messageContainer);
            chatBody.scrollTop = chatBody.scrollHeight; // ìë™ ìŠ¤í¬ë¡¤
            if (callback) callback(); // ì½œë°± í•¨ìˆ˜ í˜¸ì¶œ (í•„ìš”í•œ ê²½ìš°)
        }
    }

    // ì´ˆê¸° ë©”ì‹œì§€ ì¶œë ¥ (í˜ì´ì§€ ë¡œë“œ ì‹œ íƒ€ì´í•‘ íš¨ê³¼ ì‚¬ìš©)
    window.onload = function() {
        appendMessage('ì•ˆë…•í•˜ì„¸ìš” í–‰ë³µë‚˜ì¹¨ë°˜ ìƒë‹´ì‚¬ í–‰ë³µì´ ì…ë‹ˆë‹¤. ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤!', 'bot', true, function() {
            // ì²« ë²ˆì§¸ ë©”ì‹œì§€ê°€ ëë‚œ í›„ ë‘ ë²ˆì§¸ ë©”ì‹œì§€ ì¶œë ¥
            setTimeout(function() {
                appendMessage('ê¶ê¸ˆí•˜ì‹  ë‚´ìš©ì„ ì§ˆë¬¸í•´ì£¼ì„¸ìš” ì„±ì‹¬ì„±ì˜ê» ë‹µë³€í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤~ ğŸ˜Š', 'bot', true);
            }, 1000); // 1ì´ˆ ëŒ€ê¸° í›„ ì¶œë ¥
        });
    };

    // ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜ (íƒ€ì´í•‘ íš¨ê³¼ ì—†ì´ ë°”ë¡œ ì¶œë ¥)
    function sendMessage() {
        const userInput = document.getElementById('user-input');
        const message = userInput.value;

        if (message.trim() !== '') {
            appendMessage(message, 'user', false); // ì‚¬ìš©ì ì…ë ¥ ë°”ë¡œ ì¶œë ¥
            userInput.value = ''; // ì…ë ¥ì°½ ì´ˆê¸°í™”

            // ì„œë²„ë¡œ ì§ˆë¬¸ì„ ë³´ëƒ„
            fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                appendMessage(data.response, 'bot', false); // ë´‡ ì‘ë‹µ ë°”ë¡œ ì¶œë ¥
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    }

    // Ctrl + Enter í‚¤ë¥¼ ì²´í¬í•˜ì—¬ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜
    function checkSend(event) {
        if (event.ctrlKey && event.key === 'Enter') {
            sendMessage(); // Ctrl + Enter ì‹œ ì „ì†¡
        }
    }
</script>

</body>
</html>
